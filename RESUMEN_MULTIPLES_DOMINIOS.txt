â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  CONFIGURACIÃ“N MÃšLTIPLES DOMINIOS                      â•‘
â•‘                    ProBusiness Backend - Nginx                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ ESCENARIO: Tienes 2 o mÃ¡s frontends que necesitan acceso a tu API

Ejemplo:
  â€¢ https://app.probusiness.com.pe (Frontend principal)
  â€¢ https://admin.probusiness.com.pe (Panel administrativo)
  â€¢ http://localhost:3001 (Desarrollo local)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… OPCIÃ“N 1: NGINX CON VARIABLES (RECOMENDADO - MÃS RÃPIDO)

UbicaciÃ³n: /etc/nginx/sites-available/probusiness

CÃ³digo:
set $cors_origin "";

if ($http_origin ~* ^(https?://(
    app\.probusiness\.com\.pe|
    admin\.probusiness\.com\.pe|
    localhost:3001
))?$) {
    set $cors_origin $http_origin;
}

add_header 'Access-Control-Allow-Origin' $cors_origin always;

Ventajas:
  âœ“ RÃ¡pido (procesamiento en Nginx)
  âœ“ No requiere cambios en PHP
  âœ“ Controla exactamente quÃ© dominios acceden

Pasos:
  1. Edita el archivo nginx.conf
  2. Busca "CORS HEADERS - MÃºltiples dominios"
  3. Reemplaza los dominios con los tuyos (separados por |)
  4. Prueba: sudo nginx -t
  5. Recarga: sudo systemctl reload nginx

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… OPCIÃ“N 2: PATRÃ“N COMODÃN (SI TODOS TIENEN MISMO DOMINIO RAÃZ)

Si tus dominios son todos subdominios de probusiness.com.pe:

set $cors_origin "";

# Permite CUALQUIER subdominio de probusiness.com.pe
if ($http_origin ~* ^https?://(.*\.)?probusiness\.com\.pe$) {
    set $cors_origin $http_origin;
}

# TambiÃ©n permite localhost para desarrollo
if ($http_origin ~* ^http://localhost) {
    set $cors_origin $http_origin;
}

add_header 'Access-Control-Allow-Origin' $cors_origin always;

Ventajas:
  âœ“ Flexible: nuevos subdominios funcionan automÃ¡ticamente
  âœ“ No necesitas actualizar Nginx para cada nuevo dominio

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… OPCIÃ“N 3: LARAVEL CONFIG/CORS.PHP (ALTERNATIVA)

UbicaciÃ³n: config/cors.php

return [
    'paths' => ['api/*', 'files/*', 'storage/*'],
    
    'allowed_origins' => [
        'https://app.probusiness.com.pe',
        'https://admin.probusiness.com.pe',
        'http://localhost:3001',
    ],
    
    'allowed_origins_patterns' => [
        '#^https://.*\.probusiness\.com\.pe$#',
    ],
    
    'supports_credentials' => true,
];

Ventajas:
  âœ“ Centralizado en cÃ³digo
  âœ“ FÃ¡cil de modificar
  âœ“ Se puede usar con variables .env

Desventajas:
  âœ— MÃ¡s lento que Nginx
  âœ— Requiere procesamiento PHP en cada request

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” COMPARACIÃ“N RÃPIDA

             | Nginx Simple | Nginx PatrÃ³n | Laravel
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€
Velocidad    | â­â­â­â­â­   | â­â­â­â­â­   | â­â­â­
Flexibilidad | â­â­         | â­â­â­â­â­   | â­â­â­â­
Seguridad    | â­â­â­â­     | â­â­â­       | â­â­â­â­
Mantenimiento| â­â­â­       | â­â­â­â­     | â­â­â­â­

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ§ª CÃ“MO PROBAR DESDE LÃNEA DE COMANDOS

# Probar con dominio 1
curl -H "Origin: https://app.probusiness.com.pe" \
  -X OPTIONS https://api.probusiness.com.pe/files/test.pdf -v

# Probar con dominio 2
curl -H "Origin: https://admin.probusiness.com.pe" \
  -X OPTIONS https://api.probusiness.com.pe/files/test.pdf -v

# Probar con dominio NO permitido (debe fallar)
curl -H "Origin: https://otro-sitio.com" \
  -X OPTIONS https://api.probusiness.com.pe/files/test.pdf -v

Resultado esperado:
  âœ… Dominios permitidos: Access-Control-Allow-Origin: https://dominio.com
  âŒ Dominios rechazados: NO incluye header de CORS

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ ARCHIVOS CREADOS

1. nginx.conf
   â””â”€ ConfiguraciÃ³n base con soporte para mÃºltiples dominios

2. NGINX_CONFIGURATION.md
   â””â”€ GuÃ­a completa de instalaciÃ³n

3. setup-nginx.sh
   â””â”€ Script automatizado que te pide los dominios

4. CORS_MULTIPLES_DOMINIOS.md
   â””â”€ GuÃ­a especializada en mÃºltiples dominios

5. RESUMEN_MULTIPLES_DOMINIOS.txt
   â””â”€ Este archivo (resumen visual)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ RECOMENDACIÃ“N PARA TI

Dado que tienes 2 dominios principales:

1. Usa OPCIÃ“N 1 (Nginx Simple)

2. En nginx.conf, en la secciÃ³n CORS HEADERS, reemplaza:

    if ($http_origin ~* ^(https?://(app\.probusiness\.com\.pe|panel\.probusiness\.com\.pe|localhost:3001))?$) {
        set $cors_origin $http_origin;
    }

3. Con TUS dominios reales:

    if ($http_origin ~* ^(https?://(
        tu-dominio-1.com|
        tu-dominio-2.com|
        localhost:3001
    ))?$) {
        set $cors_origin $http_origin;
    }

4. Prueba y listo! âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â“ PREGUNTAS FRECUENTES

P: Â¿QuÃ© pasa si agrego un nuevo dominio frontend?
R: Simplemente lo agregas a la lista separado por | en la expresiÃ³n regular

P: Â¿Los dominios deben ser siempre HTTPS?
R: En desarrollo puedes usar HTTP (localhost:PORT), en producciÃ³n SÃ debe ser HTTPS

P: Â¿Puedo permitir TODOS los dominios?
R: NO - Es inseguro. Solo permite dominios especÃ­ficos que necesites

P: Â¿CuÃ¡l es mÃ¡s seguro?
R: Nginx es mÃ¡s seguro porque procesa en el servidor, no en PHP

P: Â¿Necesito cambios en el cÃ³digo Laravel?
R: Generalmente no, pero es recomendable actualizar config/cors.php tambiÃ©n

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
